---
import Layout from "../layouts/Layout.astro";
import { checkTransactionStatus } from '../../api/payment/wompiService.js'
import OrderConfirmation from '../components/orders/OrderConfirmation.vue'

const idTransaction =  new URLSearchParams(Astro.url.searchParams).get('idTransaccion');
const orderId =  new URLSearchParams(Astro.url.searchParams).get('orderId');
const getOrderStatus = await checkTransactionStatus(orderId, idTransaction);
if (!getOrderStatus.esAprobada) {
   return Astro.redirect(`/informacion-pago?orderId=${orderId}`);
} 
---

<Layout title={'Confirmacion'}>
    <OrderConfirmation client:load orderConfirtmation={getOrderStatus.esAprobada}/>
</Layout>